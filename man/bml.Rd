% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bml.R
\name{bml}
\alias{bml}
\title{Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS}
\usage{
bml(
  formula,
  family = "Gaussian",
  priors = NULL,
  inits = NULL,
  n.iter = 1000,
  n.burnin = 500,
  n.thin = max(1, floor((n.iter - n.burnin)/1000)),
  chains = 3,
  seed = NULL,
  run = TRUE,
  parallel = FALSE,
  monitor = TRUE,
  modelfile = FALSE,
  data = NULL
)
}
\arguments{
\item{formula}{A symbolic model formula.}

\item{family}{A character string specifying the model family.}

\item{priors}{A named list or character vector mapping parameter groups to JAGS priors.}

\item{inits}{A list of initial values used for all chains.}

\item{n.iter}{Total number of MCMC iterations.}

\item{n.burnin}{Number of burn-in iterations to discard.}

\item{n.thin}{Thinning rate for MCMC sampling.}

\item{chains}{Number of MCMC chains to run.}

\item{seed}{Random seed for reproducibility.}

\item{run}{Logical; if \code{TRUE} (default), JAGS is executed.}

\item{parallel}{Logical; if \code{TRUE}, run chains in parallel.}

\item{monitor}{Logical; if \code{TRUE}, store additional outputs.}

\item{modelfile}{Character or logical for saving/loading JAGS model.}

\item{data}{A data frame where each row represents a member-level observation.}
}
\value{
A list of class "bml" containing model outputs.
}
\description{
The \strong{bml} package provides a user-friendly interface for fitting Bayesian multiple-membership
multilevel models with parameterizable weight functions via JAGS.

JAGS must be installed separately: \url{https://sourceforge.net/projects/mcmc-jags/}.
}
\details{
In addition to hierarchical and cross-classified multilevel models, the \strong{bml} package allows
users to fit Bayesian multiple-membership models. Unlike tools such as
\code{\link[brms]{brms}} or MLwiN (\url{https://www.bristol.ac.uk/cmm/software/mlwin/}),
\strong{bml} lets users specify and estimate models in which membership weights are parameterized
through flexible formula syntax. This enables a more nuanced examination of how effects from
member-level units aggregate to group level (the micro-macro link).

The package automatically generates JAGS code to fit the model and processes the output
to facilitate interpretation of model parameters and diagnostics.

For accessible introductions to multiple-membership models, see Fielding and Goldstein (2006)
and Beretvas (2010). Advanced treatments include Goldstein (2011, Ch. 13),
Rasbash and Browne (2001, 2008), Browne et al. (2001), and Leckie (2013).
The package and modeling framework are introduced in:
Rosche, B. (2025). \emph{A Multilevel Model for Coalition Governments: Uncovering Party-Level
Dependencies Within and Between Governments}. \emph{Political Analysis}.
}
\section{Formula Components}{

\itemize{
  \item \strong{Outcome (Y):} The dependent variable. For survival models, use \code{Surv(time, event)}.
  \item \strong{Intercept (1):} Includes an intercept term; use \code{0} to omit it.
  \item \strong{Main-level predictors (X.main):} Variables defined at the main (group) level, separated by \code{+}.
  \item \strong{HM-level predictors (X.hm):} Variables defined at the nesting level, separated by \code{+}.
  \item \strong{Multiple membership object (\code{mm()}):} Defines how member-level units are
        associated with group-level constructs using a user-specified weighting function.
        Multiple \code{mm()} objects can be specified with different weight functions.
  \item \strong{Hierarchical membership (\code{hm()}):} Specifies nesting of main-level units within
        higher-level entities. Cross-classified structures can be modeled by including multiple \code{hm()} objects.
}

\strong{Important:} The formula parser does not support \code{I()} inside \code{bml()}.
Create transformations and interactions in your data object before modeling.
}

\section{Multiple Membership Object \code{mm()}}{

\preformatted{
mm(
  id   = id(mmid, mainid),
  vars = vars(X.mm),
  fn   = fn(w ~ 1/n, c = TRUE, ar = FALSE),
  RE   = TRUE
)
}

\strong{Components:}
\itemize{
  \item \code{id(mmid, mainid)}: Specifies identifiers linking each member-level unit (\code{mmid})
        to its corresponding group-level entities (\code{mainid}).
  \item \code{vars(X.mm)}: Specifies member-level covariates aggregated across memberships.
        Use \code{+} to include multiple variables. Set to \code{NULL} for RE-only blocks.
  \item \code{fn(w ~ ..., c, ar)}: Defines the weight function (micro-macro link).
  \item \code{RE}: Logical; if \code{TRUE}, include random effects for this block.
        Automatically \code{TRUE} if \code{vars = NULL}.
}

\strong{Multiple mm() blocks:}
You can specify multiple \code{mm()} blocks with different weight functions:
\preformatted{
mm(id = id(pid, gid), vars = vars(X1), fn = fn(w ~ 1/n), RE = FALSE) +
mm(id = id(pid, gid), vars = vars(X2), fn = fn(w ~ max(n)), RE = FALSE) +
mm(id = id(pid, gid), vars = NULL, fn = fn(w ~ 1/n), RE = TRUE)
}
}

\section{Hierarchical Membership Object \code{hm()}}{

\preformatted{
hm(id = id(hmid), vars = vars(X.hm), name = hmname, type = "RE", showFE = FALSE)
}

\strong{Components:}
\itemize{
  \item \code{id = id(hmid)}: Variable identifying nesting-level groups.
  \item \code{vars = vars(X.hm)}: Nesting-level variables, or \code{NULL}.
  \item \code{name = hmname}: Optional labels for nesting-level units.
  \item \code{type}: \code{"RE"} (default) or \code{"FE"}.
  \item \code{showFE}: If \code{TRUE} and \code{type = "FE"}, report the fixed effects.
}
}

\section{Supported Families / Links}{

\itemize{
  \item Gaussian (continuous): \code{family = "Gaussian"}
  \item Binomial (logistic): \code{family = "Binomial"}
  \item Weibull survival: \code{family = "Weibull"}, outcome: \code{Surv(time, event)}
  \item Cox survival: \code{family = "Cox"}, outcome: \code{Surv(time, event)}
}
}

\section{Priors}{

Priors can be specified for parameters. With multiple mm() blocks, use indexed names:
\preformatted{
priors = list(
  "b.mm.1 ~ dnorm(0, 0.01)",
  "b.w.1 ~ dnorm(0, 0.1)",
  "tau.mm ~ dscaled.gamma(25, 1)"
)
}
}

\examples{
\dontrun{
data(coalgov)

# Single mm() block
m1 <- bml(
  Surv(govdur, earlyterm) ~ 1 + majority +
    mm(
      id   = id(pid, gid),
      vars = vars(fdep),
      fn   = fn(w ~ 1/n, c = TRUE),
      RE   = TRUE
    ) +
    hm(id = id(cid), type = "RE"),
  family  = "Weibull",
  data    = coalgov
)

# Multiple mm() blocks with different weight functions
m2 <- bml(
  Y ~ 1 + majority +
    mm(id = id(pid, gid), vars = vars(fdep), fn = fn(w ~ 1/n), RE = FALSE) +
    mm(id = id(pid, gid), vars = NULL, fn = fn(w ~ 1/n), RE = TRUE) +
    hm(id = id(cid), type = "RE"),
  family  = "Gaussian",
  data    = coalgov
)
}

}
\author{
Benjamin Rosche <benrosche@nyu.edu>
}
