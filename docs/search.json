[{"path":"https://benrosche.github.io/bml/articles/examples.html","id":"e1","dir":"Articles","previous_headings":"","what":"The effect of air quality on home values","title":"Examples","text":"R file example can found . spatial analysis example based Harrison & Rubenfield 1978, study effect air quality home values, re-analysis Bivand 2017. study employs census tract data Boston Standard Metropolitan Statistical Area 1970. tracts containing housing units comprised entirely institutions excluded, sample contains 506 census tracts. Air quality measured concentration nitric oxides air, obtained meteorological model (Transportation Air Shed Simulation Model). refer paper information data operationalization. Let us load data plot home values across town: First, examine three canonical spatial regression models: Residual spatial effect: Y=XB+ŒªWu+œµY = XB + \\lambda Wu + \\epsilon. model called spatial error model incorporates residuals spatial units regression equation focal unit. Exogenous spatial effects: Y=XB+WXB+œµY = XB + WXB + \\epsilon. model called spatial lag-x model incorporates covariates spatial units regression equation focal unit. Endogenous spatial effect: Y=œÅWY+XB+œµY = \\rho WY + XB + \\epsilon. model called spatial autoregressive model incorporates outcomes spatial units regression equation focal unit. information models combinations can found Gibbons, Overman & Patacchini 2015. specify models, must construct spatial weight matrix WW, defines neighborhood structure location. WW N√óNN \\times N matrix, NN represents number neighborhoods. element wijw_{ij} quantifies relationship locations ii jj, convention wii=0w_{ii} = 0 along diagonal. Neighborhood relationships can defined two ways: - Binary contiguity: wij=1w_{ij} = 1 ii jj neighbors, 0 otherwise. - Distance-based weighting: wijw_{ij} continuous function distance. Continuous weights often row-standardized sum weights given location ii equals 1. R package spatialreg takes weight matrix list: Now let us estimate three models: Results:","code":"library(spData)     # spatial datasets library(sf)         # read spatial datasets library(spdep)      # create spatial weights library(spatialreg) # spatial regression models library(dplyr) library(ggplot2) library(bml)  # Load spatial data from Boston boston <-   read_sf(system.file(\"shapes/boston_tracts.gpkg\", package = \"spData\")) %>%   select(CMEDV, NOX, CRIM, RM, DIS, AGE, LSTAT, geom) %>%   st_transform(crs = 5070) %>% # use Albers equal-area conic projection   mutate(tid = row_number(), lnCMEDV=log(CMEDV), across(c(NOX, CRIM, RM, DIS, AGE, LSTAT), scale)) %>%   relocate(tid, CMEDV, lnCMEDV)  # Dependent variable: # lnCMEDV = ln(median home value in $1000)  # Plot median home values across Boston ggplot(boston, aes(fill = CMEDV)) +   geom_sf(color = NA) +   labs(fill = \"Median home value\") +   scale_fill_viridis_b() +   theme(legend.position = \"bottom\")  # Explanatory variables (standardized): # NOX     = nitric oxides concentration # CRIM    = per capita crime # RM      = avg. number of rooms per dwelling # DIS     = weighted distance to five Boston employment centers # AGE     = proportion of units built prior 1940 # LSTAT   = percentage working-class population # Create row-standardized weight matrix boston_nb <- poly2nb(as_Spatial(boston), row.names = boston$tid) # from polygon list to neighbor list  boston_wmat  <- nb2mat(boston_nb, zero.policy = TRUE) %>% as.matrix() # weight matrix boston_wlist <- nb2listw(boston_nb, style = \"W\") # weight matrix as list # Residual spatial effect (spatial error model): mod1 <-   errorsarlm(     lnCMEDV ~ NOX + CRIM + RM + DIS + AGE,     data = boston,     listw = boston_wlist   ) mod1 %>% summary()  # Exogenous spatial effect (spatial lag-x model): mod2 <-   lmSLX(     lnCMEDV ~ NOX + CRIM + RM + DIS + AGE,     data = boston,     listw = boston_wlist,     Durbin =  ~ NOX + CRIM + RM + DIS + AGE   ) mod2 %>% summary()  # Endogenous spatial effect (spatial autoregressive model): mod3 <-   lagsarlm(     lnCMEDV ~ NOX + CRIM + RM + DIS + AGE,     data = boston,     listw = boston_wlist   ) mod3 %>% summary() # 1. The spatial error model estimates that after conditioning on those five covariates, the residual is still spatially correlated, as $\\lambda$=`r round(mod1$lambda,2)`.  # 2.  The spatial lag-x model estimates an exogenous spatial effect for each of the considered covariates. The effect of air quality of neighboring locations, for instance, is estimated to be $\\beta$=`r round(mod2$coefficients['lag.NOX'],2)`. That is, the home values of a given neighborhood increases if the air quality of surrounding neighborhoods decreases.  # 3.  The spatial autoregessive (SAR) model estimates a endogenous spatial effect of $\\rho$=`r round(mod3$rho,2)`. That is, the SAR summarizes the spatial dependency in one coefficient."},{"path":"https://benrosche.github.io/bml/articles/examples.html","id":"the-mmmm-for-spatial-analysis","dir":"Articles","previous_headings":"The effect of air quality on home values","what":"The MMMM for spatial analysis","title":"Examples","text":"Let yiy_{} denote outcome location ii. Using MMMM, can model outcome based : () effects location‚Äôs features, xi‚ä∫Œ≤+œµix_{}^{\\intercal} \\beta + \\epsilon_{} (ii) effects neighbors‚Äô features, ‚àëj‚ààn()wj(zj‚ä∫Œ≥+uj)\\sum_{j \\n()} w_{j} (z_{j}^{\\intercal} \\gamma + u_{j}), jj indexes neighbors, n()n() set neighbors location ii, zjz_{j} represents observed features neighbor jj, uju_{j} captures combined influence unobserved features. model closely resembles combination spatial lag spatial error models. key distinction error term location decomposed two components: random effect role focal location separate random effect role neighbor. Conceptually, combination exogenous spatial effects spatial error intuitive, location influenced neighbors‚Äô entire right-hand side regression equation. contrast, endogenous spatial effect model challenging interpret faces identification issues endogenous exogenous effects included (spatial Durbin model). estimate spatial MMMM, neighbors location must included dataframe individual rows: tract tid, one row neighbors tid_nb. rows contain covariates tid, remain constant across neighbors, well covariates neighbors , NOX_nb, CRIM_nb, ‚Ä¶. setup, now ready estimate MMMM: Let‚Äôs take closer look thebml() function typing ?bml. formula object important component formula object, case looks like : lnCMEDV ~ NOX + CRIM + RM + DIS + AGE + mm(id(tid_nb, tid), mmc(NOX_nb + CRIM_nb + RM_nb + DIS_nb + AGE_nb), mmw(w ~ 1/n, constraint=1)) difference compared lm() formula inclusion mm() container. Within container, define three sub-containers: - ids() identifiers - mmc() covariates considered, - mmw() endogenize weight function. , w ~ 1/n specifies row-standardized weight. combination spatial lag spatial error models can also estimated within spatial regression framework. Let‚Äôs estimate compare results: estimates similar identical due differences estimation algorithms (maximum likelihood vs.¬†Bayesian MCMC) slight differences model specifications. advantage using errorsarlm faster estimation ability account endogenous errors. model aligns needs, generally best estimate using spatialreg package. Weight function regression MMMM, however, allows weights modeled function covariates. Instead assuming fixed weighting scheme, can estimate whether neighbor‚Äôs influence location varies based specific covariates. example, hypothesize neighbor‚Äôs weight overall neighborhood effect depends similarity neighbor focal location‚Äîidea inspired social network theory. define similarity inverse average absolute difference neighbor focal location across six considered covariates. measure captures dissimilarity, label variable DIFF: weight function specified within mmw() container, allowing function produces bounded weights. Logical operators ==, >, < can used define conditions enable aggregation functions, min max. , use following functional form: w=1nexp‚Å°(‚àíXŒ≤) w = \\frac{1}{n^{\\exp(-X\\beta)}} nn number neighbors location ii, XŒ≤X\\beta represents covariates used determine weights. formulation two key advantages: 1. ensures weights remain bounded 0 1. 2. XŒ≤=ùüéX\\beta = \\boldsymbol{0}, weights simplify w=1nw = \\frac{1}{n}, corresponds standard row-standardized weights. issue scaling: row-standardized weights, total sum weights ‚àë=1506‚àëjwij=‚àë=15061=506\\sum_{=1}^{506} \\sum_{j} w_{ij} = \\sum_{=1}^{506} 1 = 506. ensure overall sum remains unchanged, need carefully specify constraints. Recall neighbor effects aggregated ‚àëj‚ààn()wj(zj‚ä∫Œ≥+uj)\\sum_{j \\n()} w_{j} (z_{j}^{\\intercal} \\gamma + u_{j}). total sum weights changes, regression coefficients Œ≥\\gamma rescaled. prevent , can apply one two constraints: constraint=1: Ensures weights location‚Äôs neighbors sum 1 focal location, allowing vary within location. constraint=2: Ensures weights sum total number neighborhoods, allowing vary within across locations. constraints identify model different substantive interpretations. , use weights sum 1 focal location allowing variation within locations (constraint=1): find degree dissimilarity location neighbors significantly affects aggregation weights, similar neighbors exerting greater influence less similar ones. words, features neighbors differ significantly focal location terms air quality, crime levels, factors less impact home values focal neighborhood. insight impossible uncover using conventional spatial regression models! set monitor=T, can take look weight estimates: weights sum 1 focal location vary across neighbors location. Ben 2do: Introduce predict() function Compare predictive performance","code":"# Neighbor list to data.frame nb2df <- function(nb) {   return(     data.frame(       tid = rep(1:length(nb), sapply(nb, length)),       tid_nb = unlist(nb)     )   ) }  boston_df <-   nb2df(boston_nb) %>%   group_by(tid) %>%   mutate(n=n()) %>%   ungroup() %>%   inner_join(boston, by=c(\"tid\")) %>% # own features   inner_join(                         # neighbor features     as.data.frame(boston) %>%       select(-CMEDV,-lnCMEDV, -geom) %>%       rename_with(~paste0(.,\"_nb\")),     by=c(\"tid_nb\")   )  head(boston_df %>% select(tid, tid_nb, NOX, CRIM, NOX_nb, CRIM_nb)) # Spatial random effect: mod.bml1 <-   bml(     lnCMEDV ~       NOX + CRIM + RM + DIS + AGE +       mm(         id(tid_nb, tid),         mmc(),         mmw(w ~ 1/n, c=T)       ),     n.iter = 1000, n.burnin = 100, seed=1, monitor = T,     data = boston_df   )  names(mod.bml1)  mod.bml1 %>% summary()  # Spatial fixed effects + spatial random effect: mod.bml2 <-   bml(     lnCMEDV ~       NOX + CRIM + RM + DIS + AGE +       mm(         id(tid_nb, tid),         mmc(NOX_nb + CRIM_nb + RM_nb + DIS_nb + AGE_nb),         mmw(w ~ 1/n, c=T)       ),     n.iter = 1000, n.burnin = 100, seed=1, monitor = T,     data = boston_df   )  mod.bml2 %>% summary()  # Calculate spatial correlation in the residual getLambda <- function(x) {   s.l1 <- x$reg.table[\"sigma.l1\", \"coefficients\"]   s.l2 <- x$reg.table[\"sigma.l2\", \"coefficients\"]   return(s.l1^2/(s.l1^2+s.l2^2)) }  mod.bml1 %>% getLambda() mod.bml2 %>% getLambda() # Exogenous + residual spatial effect (combination of spatial lag model and spatial error model): mod2 <-   errorsarlm(     lnCMEDV ~ NOX + CRIM + RM + DIS + AGE,     data = boston,     listw = boston_wlist,     Durbin =  ~ NOX + CRIM + RM + DIS + AGE   ) mod2 %>% summary()  # Plot coefficients next to each other coefs <-   mod.bml2$reg.table[,c(1,2,4,5)] %>%   mutate(model=\"MMMM\") %>%   add_row(     data.frame(model=\"SLM\", coefficients=coef(mod2)[-1], confint(mod2, level=0.95)[-1,]) %>%       rename(lb=X2.5.., ub=X97.5..) %>%       tibble::rownames_to_column(\"variable\") %>%       mutate(         variable=           case_when(             startsWith(variable, \"lag.\") ~ paste0(sub(\"lag.\", \"\", variable), \"_nb\"),             variable==\"(Intercept)\" ~ \"X0\",             TRUE ~ variable))   ) %>%   filter(!variable %in% c(\"X0\", \"sigma.l1\", \"sigma.l2\", \"DIC\"))  ggplot(coefs, aes(x=variable, y=coefficients, color=model)) +   geom_hline(yintercept = 0, color=\"red\") +   geom_point(position=position_dodge(width=0.3)) +   geom_pointrange(aes(ymin = lb, ymax = ub), position=position_dodge(width=0.3))+   labs(title = \"Coefficients\", x = \"Variables\", y=\"\", color=\"Model\") +   theme(legend.position = \"bottom\") +   coord_flip() # Difference between a focal location and its neighbors boston_df2 <-   boston_df %>%   mutate(     DIFF=1/6*(abs(NOX-NOX_nb)+abs(CRIM-CRIM_nb)+abs(RM-RM_nb)+abs(DIS-DIS_nb)+abs(AGE-AGE_nb)+abs(LSTAT-LSTAT_nb))   ) # Spatial fixed effects + spatial random effect with \"endogenized\" weights: mod.bml3 <-   bml(     lnCMEDV ~       NOX + CRIM + RM + DIS + AGE +       mm(         id(tid_nb, tid),         mmc(NOX_nb + CRIM_nb + RM_nb + DIS_nb + AGE_nb),         mmw(w ~ 1/n^exp(-(b1*DIFF)), c=T)       ),     priors=c(\"b.w~dnorm(0,1)\"), n.iter = 1000, n.burnin = 100, seed=1, monitor = T,     data = boston_df2   )  mod.bml3 %>% summary()  monetPlot(mod.bml3, parameter=\"b.w\") data.frame(mod.bml3$w, sum=rowSums(mod.bml3$w, na.rm = T)) %>% head()  rowSums(mod.bml3$w, na.rm = T) %>% sum()"},{"path":"https://benrosche.github.io/bml/articles/examples.html","id":"e2","dir":"Articles","previous_headings":"","what":"All your friends or just your best friend?","title":"Examples","text":"widely used peer effect model economics linear--means model, assumes peers group exert equal influence individual. contrast, sociology often emphasizes best-friend model, assumes individual‚Äôs primary influence comes closest friend. example, use MMMM empirically test models better fits data.","code":"data(schoolnets)  SAS <- function(nodedat, vars=NULL, suffix) {    # Helper function to select node features as _from or _to    if(is.null(vars)) { # Return all variables if no variable-list specified     return(       nodedat %>%         dplyr::rename_with(~paste0(., suffix), everything())     )   } else {     return(       nodedat %>%         dplyr::select(!!vars) %>%         dplyr::rename_with(~paste0(., suffix), everything())     )   } }  # Create school network data  schoolnets <-    nodedat %>%    # add friend features    left_join(     edgedat %>%       select(youthid_from, youthid_to, rank) %>%       left_join(         SAS(nodedat, vars=c(\"youthid\", \"parent_inc\"), suffix=\"_to\"),         by=c(\"youthid_to\")       ) %>%       group_by(youthid_from) %>%       mutate(         bestie = rank==1,         parent_inc_mean = mean(parent_inc_to, na.rm=T),       ),     by=c(\"youthid\"=\"youthid_from\")   ) %>%    # count number of friends    tidyr::drop_na() %>%   add_count(youthid, name=\"n_friends\") %>%   filter(n_friends>=1) %>%    mutate(across(everything(), ~as.numeric(.)))   # Naive linear-in-means model mod4 <- lm(test_cogn ~ sex + etn + parent_edu + parent_inc + parent_inc_mean, data=schoolnets)  # MMMM comparing mean to max aggregation mod.bml4 <-   bml(     test_cogn ~       sex + etn + parent_edu + parent_inc +       mm(         id(youthid_to, youthid),         mmc(parent_inc_to),         mmw(w ~ b1*1/n_friends+(1-b1)*bestie, c=T)       ),     n.iter = 1000, n.burnin = 100, seed=1, monitor = T, priors = c(\"b.w~dunif(0,1)\"),     data = schoolnets   )  mod.bml4 %>% summary() monetPlot(mod.bml4, parameter=\"b.w\") # posterior distribution of the weight coefficient  mod.bml4$w %>% head() # inspect estimated weight matrix # The results suggest that the linear-in-means model is appropriate: the best friend does not appear to have a greater impact than the other nominated friends as b1=`r mod.bml4$reg.table %>% filter(variable==\"b.w\") %>% pull(coefficients) %>% round(.,2)`. Since the estimated aggregation is close to linear-in-means, the effect size of `parent_inc_to` does not differ between models: coefs <-   mod.bml4$reg.table[,c(1,2,4,5)] %>%   filter(!variable %in% c(\"X0\", \"sigma.l1\", \"sigma.l2\", \"DIC\")) %>%   mutate(model=\"MMMM\") %>%   add_row(     data.frame(model=\"SLM\", coefficients=coef(mod4)[-1], confint(mod4, level=0.95)[-1,]) %>%       rename(lb=X2.5.., ub=X97.5..) %>%       tibble::rownames_to_column(\"variable\") %>%       mutate(variable=ifelse(variable==\"parent_inc_mean\", \"parent_inc_to\", variable))   ) rownames(coefs) <- NULL  ggplot(coefs, aes(x=variable, y=coefficients, color=model)) +   geom_hline(yintercept = 0, color=\"red\") +   geom_point(position=position_dodge(width=0.3)) +   geom_pointrange(aes(ymin = lb, ymax = ub), position=position_dodge(width=0.3))+   labs(title = \"Coefficients\", x = \"Variables\", y=\"\", color=\"Model\") +   theme(legend.position = \"bottom\") +   coord_flip()"},{"path":"https://benrosche.github.io/bml/articles/examples.html","id":"e3","dir":"Articles","previous_headings":"","what":"The effect of political parties‚Äô financial dependency on the survival coalition governments","title":"Examples","text":", replicate example paper, examining whether survival coalition governments influenced parties‚Äô financial dependencies whether influence varies across coalition partners. Rosche (2025). Tbd","code":""},{"path":"https://benrosche.github.io/bml/articles/installation.html","id":"install-jags","dir":"Articles","previous_headings":"","what":"1. Install JAGS","title":"Installation","text":"Install latest JAGS version operating system : http://mcmc-jags.sourceforge.net/ installing JAGS, restart R rjags can find .","code":""},{"path":"https://benrosche.github.io/bml/articles/installation.html","id":"install-bml-from-github","dir":"Articles","previous_headings":"","what":"2. Install bml from GitHub","title":"Installation","text":"bml CRAN yet, install GitHub. Using remotes keeps dependency footprint small. want build vignettes locally installation:","code":"install.packages(\"remotes\") remotes::install_github(\"benrosche/bml\")"},{"path":"https://benrosche.github.io/bml/articles/installation.html","id":"verify-the-installation","dir":"Articles","previous_headings":"","what":"3. Verify the installation","title":"Installation","text":"","code":"library(bml) packageVersion(\"bml\")  # Optional: confirm that rjags is linked against JAGS rjags::jags.version()"},{"path":"https://benrosche.github.io/bml/articles/installation.html","id":"troubleshooting","dir":"Articles","previous_headings":"","what":"Troubleshooting","title":"Installation","text":"Error: (converted warning) ... installing remotes treats installation warning error machine, can opt : JAGS found / rjags fails load Make sure JAGS installed (just R packages), restart R. Windows, confirm installed 64-bit JAGS build using 64-bit R.","code":"Sys.setenv(R_REMOTES_NO_ERRORS_FROM_WARNINGS = \"true\") remotes::install_github(\"benrosche/bml\")"},{"path":"https://benrosche.github.io/bml/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Benjamin Rosche. Author, maintainer.","code":""},{"path":"https://benrosche.github.io/bml/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Rosche B (2026). bml: Bayesian multiple-membership multilevel models parameterizable weight functions.. R package version 0.2.0, https://benrosche.github.io/bml.","code":"@Manual{,   title = {bml: Bayesian multiple-membership multilevel models with parameterizable weight functions.},   author = {Benjamin Rosche},   year = {2026},   note = {R package version 0.2.0},   url = {https://benrosche.github.io/bml}, }"},{"path":[]},{"path":"https://benrosche.github.io/bml/index.html","id":"bayesian-multiple-membership-multilevel-regression-models-with-endogenized-weights","dir":"","previous_headings":"","what":"Bayesian multiple membership multilevel regression models with endogenized weights","title":"bml","text":"currently working getting package ready submission CRAN. rmm package provides interface fit Bayesian multiple membership multilevel models endogenized weights using JAGS within R variety outcomes (linear, logit, conditional logit, Cox, Weibull). multilevel analyses examine lower-level units (e.g.¬†individuals) affected embedding contextual/aggregate units higher level (e.g.¬†neighborhoods) (= macro-micro link). rmm package uses multiple membership multilevel model conceptually reverse setup. allows studying effect units lower levels propagates higher level (= micro-macro link). Previous studies examining micro-macro links either aggregated disaggregated data. approaches obstruct inherent aggregation problem, ignore dependencies among observations, induces excessive Type-Type-II error, separate micro- macro-level variance. generalized multiple membership multilevel model (MMMM) able overcome problems explicitly modeling aggregation micro macro level including aggregation function regression model. theoretically statistically sound solution study micro-macro links regression analysis.","code":""},{"path":"https://benrosche.github.io/bml/index.html","id":"with-the-rmm-package-you-can","dir":"","previous_headings":"","what":"With the rmm package, you can‚Ä¶","title":"bml","text":"explicitly model effect lower level units propagate higher level examine fit different aggregation functions, min, max, mean, sum uncover heterogeneity effect lower-level units higher-level entities control dependencies arise multiple membership (crisscrossing) data structure estimate (residual) variance lower higher level data structure modeled:","code":""},{"path":"https://benrosche.github.io/bml/index.html","id":"section-1","dir":"","previous_headings":"","what":"bml","title":"bml","text":"example coalition governments Israel, political parties level-1 units, governments level-2 units, relationship parties governments multiple membership structure. just example. Multiple membership structures ubiquitous real world. applications include: MMMM can used model spatial structures. Level-1 units, case, neighborhoods influence sphere focal neighborhood, level-2 units focal neighborhoods. benefit using MMMM spatial regression models weight matrix can endogenized, currently possible methods MMMM can used model network structures. possibility explored work (Tranmer et al.¬†2014), MMMM allows endogenize weight matrix, currently possible multiple membership multilevel software, brms MLWiN. multiple membership structures wild: multi-party wars, treaties, international organizations rmm() function looks like:","code":"data(coalgov) rmm(Y ~ 1 + X_l2 +        X_l3 + hm(id=id_l3, type=RE) +       mm(id(id_l2, id_l1), mmc(X_l1), mmw(w ~ 1/n^exp(-(X_w)))),      family=\"Gaussian\", data=coalgov)"},{"path":"https://benrosche.github.io/bml/index.html","id":"developers","dir":"","previous_headings":"","what":"Developers","title":"bml","text":"welcome contributions package! Feel free submit changes review contact questions.","code":""},{"path":"https://benrosche.github.io/bml/index.html","id":"issues-or-feature-requests","dir":"","previous_headings":"","what":"Issues or Feature Requests","title":"bml","text":"like log issue submit feature request, please create new issue comment existing issue GitHub Issues repo.","code":""},{"path":"https://benrosche.github.io/bml/index.html","id":"changelog","dir":"","previous_headings":"","what":"Changelog","title":"bml","text":"See NEWS.md package changelog. information can found ","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":null,"dir":"Reference","previous_headings":"","what":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"bml package provides user-friendly interface fitting Bayesian multiple-membership multilevel models parameterizable weight functions via JAGS. JAGS must installed separately: https://sourceforge.net/projects/mcmc-jags/.","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"","code":"bml(   formula,   family = \"Gaussian\",   priors = NULL,   inits = NULL,   n.iter = 1000,   n.burnin = 500,   n.thin = max(1, floor((n.iter - n.burnin)/1000)),   chains = 3,   seed = NULL,   run = TRUE,   parallel = FALSE,   monitor = TRUE,   modelfile = FALSE,   data = NULL )"},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"formula symbolic model formula. family character string specifying model family. priors named list character vector mapping parameter groups JAGS priors. inits list initial values used chains. n.iter Total number MCMC iterations. n.burnin Number burn-iterations discard. n.thin Thinning rate MCMC sampling. chains Number MCMC chains run. seed Random seed reproducibility. run Logical; TRUE (default), JAGS executed. parallel Logical; TRUE, run chains parallel. monitor Logical; TRUE, store additional outputs. modelfile Character logical saving/loading JAGS model. data data frame row represents level-1 observation.","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"list class \"bml\" containing model outputs.","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"addition hierarchical cross-classified multilevel models, bml package allows users fit Bayesian multiple-membership models. Unlike tools brms MLwiN (https://www.bristol.ac.uk/cmm/software/mlwin/), bml lets users specify estimate models membership weights parameterized flexible formula syntax. enables nuanced examination effects lower-level units aggregate higher levels (micro-macro link). package automatically generates JAGS code fit model processes output facilitate interpretation model parameters diagnostics. accessible introductions multiple-membership models, see Fielding Goldstein (2006) Beretvas (2010). Advanced treatments include Goldstein (2011, Ch. 13), Rasbash Browne (2001, 2008), Browne et al. (2001), Leckie (2013). package modeling framework introduced : Rosche, B. (2025). Multilevel Model Coalition Governments: Uncovering Party-Level Dependencies Within Governments. Political Analysis.","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"formula-components","dir":"Reference","previous_headings":"","what":"Formula Components","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"Outcome (Y): dependent variable. survival models, use Surv(time, event). Intercept (1): Includes intercept term; use 0 omit . Level-2 predictors (X.L2): Variables defined level 2, separated +. Level-3 predictors (X.L3): Variables defined level 3, separated +. Multiple membership object (mm()): Defines lower-level (level-1) units         associated higher-level (level-2) constructs using user-specified weighting function.         Multiple mm() objects can specified different weight functions. Hierarchical membership (hm()): Specifies nesting level-2 units within         level-3 entities. Cross-classified structures can modeled including multiple hm() objects. Important: formula parser support () inside bml(). Create transformations interactions data object modeling.","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"multiple-membership-object-mm-","dir":"Reference","previous_headings":"","what":"Multiple Membership Object mm()","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"Components: id(l1id, l2id): Specifies identifiers linking level-1 unit (l1id)         corresponding level-2 entities (l2id). vars(X.L1): Specifies level-1 covariates aggregated across memberships.         Use + include multiple variables. Set NULL RE-blocks. fn(w ~ ..., c, ar): Defines weight function (micro-macro link). RE: Logical; TRUE, include random effects block.         Automatically TRUE vars = NULL. Multiple mm() blocks: can specify multiple mm() blocks different weight functions:","code":"mm(   id   = id(l1id, l2id),   vars = vars(X.L1),   fn   = fn(w ~ 1/n, c = TRUE, ar = FALSE),   RE   = TRUE ) mm(id = id(pid, gid), vars = vars(X1), fn = fn(w ~ 1/n), RE = FALSE) + mm(id = id(pid, gid), vars = vars(X2), fn = fn(w ~ max(n)), RE = FALSE) + mm(id = id(pid, gid), vars = NULL, fn = fn(w ~ 1/n), RE = TRUE)"},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"hierarchical-membership-object-hm-","dir":"Reference","previous_headings":"","what":"Hierarchical Membership Object hm()","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"Components: id = id(l3id): Variable identifying level-3 groups. vars = vars(X.L3): Level-3 variables, NULL. name = l3name: Optional labels level-3 units. type: \"RE\" (default) \"FE\". showFE: TRUE type = \"FE\", report fixed effects.","code":"hm(id = id(l3id), vars = vars(X.L3), name = l3name, type = \"RE\", showFE = FALSE)"},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"supported-families-links","dir":"Reference","previous_headings":"","what":"Supported Families / Links","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"Gaussian (continuous): family = \"Gaussian\" Binomial (logistic): family = \"Binomial\" Weibull survival: family = \"Weibull\", outcome: Surv(time, event) Cox survival: family = \"Cox\", outcome: Surv(time, event)","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"priors","dir":"Reference","previous_headings":"","what":"Priors","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"Priors can specified parameters. multiple mm() blocks, use indexed names:","code":"priors = list(   \"b.l1.1 ~ dnorm(0, 0.01)\",   \"b.w.1 ~ dnorm(0, 0.1)\",   \"tau.l1 ~ dscaled.gamma(25, 1)\" )"},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"Benjamin Rosche <benrosche@nyu.edu>","code":""},{"path":"https://benrosche.github.io/bml/reference/bml.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Bayesian Multiple-Membership Multilevel Models with Parameterizable Weight Functions Using JAGS ‚Äî bml","text":"","code":"if (FALSE) { # \\dontrun{ data(coalgov)  # Single mm() block m1 <- bml(   Surv(govdur, earlyterm) ~ 1 + majority +     mm(       id   = id(pid, gid),       vars = vars(fdep),       fn   = fn(w ~ 1/n, c = TRUE),       RE   = TRUE     ) +     hm(id = id(cid), type = \"RE\"),   family  = \"Weibull\",   data    = coalgov )  # Multiple mm() blocks with different weight functions m2 <- bml(   Y ~ 1 + majority +     mm(id = id(pid, gid), vars = vars(fdep), fn = fn(w ~ 1/n), RE = FALSE) +     mm(id = id(pid, gid), vars = NULL, fn = fn(w ~ 1/n), RE = TRUE) +     hm(id = id(cid), type = \"RE\"),   family  = \"Gaussian\",   data    = coalgov ) } # }"},{"path":"https://benrosche.github.io/bml/reference/coalgov.html","id":null,"dir":"Reference","previous_headings":"","what":"Coalition governments in comparative perspective (1944-2013) ‚Äî coalgov","title":"Coalition governments in comparative perspective (1944-2013) ‚Äî coalgov","text":"unit analysis dataset level 1, party level case. pid indicates party identity gid indicates government identity ...","code":""},{"path":"https://benrosche.github.io/bml/reference/coalgov.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Coalition governments in comparative perspective (1944-2013) ‚Äî coalgov","text":"","code":"data(coalgov)"},{"path":"https://benrosche.github.io/bml/reference/coalgov.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Coalition governments in comparative perspective (1944-2013) ‚Äî coalgov","text":"data frame 1286 rows 21 variables: Col1 description Col1","code":""},{"path":"https://benrosche.github.io/bml/reference/coalgov.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Coalition governments in comparative perspective (1944-2013) ‚Äî coalgov","text":"","code":"data(coalgov)"},{"path":"https://benrosche.github.io/bml/reference/fn.html","id":null,"dir":"Reference","previous_headings":"","what":"Specify weight function ‚Äî fn","title":"Specify weight function ‚Äî fn","text":"Helper function specify weight function mm() objects.","code":""},{"path":"https://benrosche.github.io/bml/reference/fn.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Specify weight function ‚Äî fn","text":"","code":"fn(w = w ~ 1/n, c = TRUE, ar = FALSE)"},{"path":"https://benrosche.github.io/bml/reference/fn.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Specify weight function ‚Äî fn","text":"w formula specifying weight function (default: w ~ 1/n) c Logical; TRUE (default), weights constrained sum 1 ar Logical; TRUE, autoregressive random effects used (default: FALSE)","code":""},{"path":"https://benrosche.github.io/bml/reference/fn.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Specify weight function ‚Äî fn","text":"bml_fn object containing weight function specification","code":""},{"path":"https://benrosche.github.io/bml/reference/hm.html","id":null,"dir":"Reference","previous_headings":"","what":"Hierarchical membership specification ‚Äî hm","title":"Hierarchical membership specification ‚Äî hm","text":"Specifies hierarchical (level-3) structure including variables effect type.","code":""},{"path":"https://benrosche.github.io/bml/reference/hm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hierarchical membership specification ‚Äî hm","text":"","code":"hm(id, vars = NULL, name = NULL, type = \"RE\", showFE = FALSE)"},{"path":"https://benrosche.github.io/bml/reference/hm.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hierarchical membership specification ‚Äî hm","text":"id id() object specifying level-3 identifier: id(l3id) vars vars() object specifying level-3 variables, NULL name Unquoted variable name level-3 labels (optional) type Character; \"RE\" random effects (default) \"FE\" fixed effects showFE Logical; TRUE type = \"FE\", report fixed effects (default: FALSE)","code":""},{"path":"https://benrosche.github.io/bml/reference/hm.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hierarchical membership specification ‚Äî hm","text":"bml_hm object containing hierarchical membership specification","code":""},{"path":"https://benrosche.github.io/bml/reference/id.html","id":null,"dir":"Reference","previous_headings":"","what":"Specify ID variables ‚Äî id","title":"Specify ID variables ‚Äî id","text":"Helper function specify level identifiers mm() hm() objects.","code":""},{"path":"https://benrosche.github.io/bml/reference/id.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Specify ID variables ‚Äî id","text":"","code":"id(...)"},{"path":"https://benrosche.github.io/bml/reference/id.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Specify ID variables ‚Äî id","text":"... Unquoted variable names (e.g., id(l1id, l2id) mm(), id(l3id) hm())","code":""},{"path":"https://benrosche.github.io/bml/reference/id.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Specify ID variables ‚Äî id","text":"bml_id object containing variable names characters","code":""},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"Computes common convergence diagnostics selected parameters JAGS/BUGS fit returns compact, report-ready table. diagnostics include Gelman‚ÄìRubin \\(\\hat{R}\\), Geweke z-scores, Heidelberger-Welch stationarity p-values, autocorrelation lag 50.","code":""},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"","code":"mcmcDiag(bml.out, parameters)"},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"bml.model fit object containing JAGS output, typically returned R2jags::jags(), component $jags.$BUGSoutput. parameters Character vector parameter names (patterns) extract, passed crMCMC. Depending crMCMC() implementation, may exact names patterns (e.g., prefix like \"b.l2\" matches \"b.l2[1]\", \"b.l2[2]\", ‚Ä¶).","code":""},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"data.frame one row per diagnostic one column per   parameter; cell entries average diagnostic values across chains.   Row names include: \"Gelman/Rubin convergence statistic\",   \"Geweke z-score\", \"Heidelberger/Welch p-value\",   \"Autocorrelation (lag 50)\".","code":""},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"Internally, function converts BUGS/JAGS output coda::mcmc.list via crMCMC, computes per-chain diagnostics averages across chains parameter: Gelman‚ÄìRubin (\\(\\hat{R}\\)): coda::gelman.diag().         Values close 1 indicate convergence; common heuristic         \\(\\hat{R} \\le 1.1\\). Geweke z-score: coda::geweke.diag().         Large absolute values (e.g., \\(|z|>2\\)) suggest lack convergence. Heidelberger‚ÄìWelch p-value: coda::heidel.diag() tests         null stationarity chain segment. Autocorrelation (lag 50): coda::autocorr() lag 50,         averaged across chains. statistics rounded three decimals. returned table transposed rows diagnostics columns parameters.","code":""},{"path":[]},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"Benjamin Rosche benrosche@nyu.edu","code":""},{"path":"https://benrosche.github.io/bml/reference/mcmcDiag.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summarize MCMC convergence diagnostics ‚Äî mcmcDiag","text":"","code":"if (FALSE) { # \\dontrun{ mcmcdiag(fit, parameters = c(\"beta\", \"sigma\")) } # }"},{"path":"https://benrosche.github.io/bml/reference/mm.html","id":null,"dir":"Reference","previous_headings":"","what":"Multiple membership specification ‚Äî mm","title":"Multiple membership specification ‚Äî mm","text":"Specifies multiple membership structure including variables, weight function, random effects.","code":""},{"path":"https://benrosche.github.io/bml/reference/mm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Multiple membership specification ‚Äî mm","text":"","code":"mm(id, vars = NULL, fn = fn(), RE = NULL)"},{"path":"https://benrosche.github.io/bml/reference/mm.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Multiple membership specification ‚Äî mm","text":"id id() object specifying level-1 level-2 identifiers: id(l1id, l2id) vars vars() object specifying level-1 variables aggregate, NULL RE-fn fn() object specifying weight function (default: fn(w ~ 1/n, c = TRUE, ar = FALSE)) RE Logical; TRUE, include random effects. Automatically TRUE vars NULL.","code":""},{"path":"https://benrosche.github.io/bml/reference/mm.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Multiple membership specification ‚Äî mm","text":"bml_mm object containing multiple membership specification","code":""},{"path":"https://benrosche.github.io/bml/reference/monetPlot.html","id":null,"dir":"Reference","previous_headings":"","what":"Create monetPlots for your bml results. ‚Äî monetPlot","title":"Create monetPlots for your bml results. ‚Äî monetPlot","text":"function monetPlot creates density plot posterior distribution model parameters traceplot led density.","code":""},{"path":"https://benrosche.github.io/bml/reference/monetPlot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create monetPlots for your bml results. ‚Äî monetPlot","text":"","code":"monetPlot(bml, parameter, label = NULL, r = 2, yaxis = T)"},{"path":"https://benrosche.github.io/bml/reference/monetPlot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create monetPlots for your bml results. ‚Äî monetPlot","text":"bml bml object. bml run monitor=T parameter string parameter name. internal name used, rownames bml reg.table output. label String describe parameter graph's x-axis. Optional. specified, internal parameter name used. r Specify number decimal places. Default equals 3. yaxis Logical. FALSE, y-axis title omitted.","code":""},{"path":"https://benrosche.github.io/bml/reference/monetPlot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create monetPlots for your bml results. ‚Äî monetPlot","text":"Returns plot. solid vertical 0 dashed vertical line mode posterior distributions.","code":""},{"path":"https://benrosche.github.io/bml/reference/monetPlot.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Create monetPlots for your bml results. ‚Äî monetPlot","text":"Benjamin Rosche <benrosche@nyu.edu>","code":""},{"path":"https://benrosche.github.io/bml/reference/monetPlot.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create monetPlots for your bml results. ‚Äî monetPlot","text":"","code":"data(coalgov) m1 <- bml(Surv(govdur, earlyterm) ~ 1 + majority + mm(id(pid, gid), mmc(fdep), mmw(w ~ 1/n, constraint=T)) + hm(id=cid, name=cname, type=RE, showFE=F),           family=\"Weibull\", monitor=T, data=coalgov) #> Error in c(ids, vars, l1, l3) %<-% dissectFormula(formula, family, data): could not find function \"%<-%\" monetPlot(m1, parameter=\"b.l1\") #> Loading required package: dplyr #>  #> Attaching package: 'dplyr' #> The following objects are masked from 'package:stats': #>  #>     filter, lag #> The following objects are masked from 'package:base': #>  #>     intersect, setdiff, setequal, union #> Loading required package: tidyr #> Error: object 'm1' not found"},{"path":"https://benrosche.github.io/bml/reference/schoolnets.html","id":null,"dir":"Reference","previous_headings":"","what":"CILS4EU ‚Äî nodedat","title":"CILS4EU ‚Äî nodedat","text":"... schoolid school identifier classid classroom identifier youthid student identifier sex etn parent_edu parent_inc test_lang test_cogn","code":""},{"path":"https://benrosche.github.io/bml/reference/schoolnets.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"CILS4EU ‚Äî nodedat","text":"","code":"data(schoolnets)"},{"path":"https://benrosche.github.io/bml/reference/schoolnets.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"CILS4EU ‚Äî nodedat","text":"... Col1 description Col1","code":""},{"path":"https://benrosche.github.io/bml/reference/schoolnets.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"CILS4EU ‚Äî nodedat","text":"","code":"data(schoolnets)"},{"path":"https://benrosche.github.io/bml/reference/summary.bml.html","id":null,"dir":"Reference","previous_headings":"","what":"summary() method for an bml object ‚Äî summary.bml","title":"summary() method for an bml object ‚Äî summary.bml","text":"summary() method bml object","code":""},{"path":"https://benrosche.github.io/bml/reference/summary.bml.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"summary() method for an bml object ‚Äî summary.bml","text":"","code":"# S3 method for class 'bml' summary(bml, r = 3)"},{"path":"https://benrosche.github.io/bml/reference/summary.bml.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"summary() method for an bml object ‚Äî summary.bml","text":"Returns table regression results.","code":""},{"path":"https://benrosche.github.io/bml/reference/summary.bml.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"summary() method for an bml object ‚Äî summary.bml","text":"Benjamin Rosche <benrosche@nyu.edu>","code":""},{"path":"https://benrosche.github.io/bml/reference/summary.bml.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"summary() method for an bml object ‚Äî summary.bml","text":"","code":"data(coalgov) m1 <- bml(Surv(govdur, earlyterm, govmaxdur) ~ 1 + mm(id(pid, gid), mmc(fdep), mmw(w ~ 1/n, constraint=1)) + majority + hm(id=cid, name=cname, type=RE, showFE=F),           family=\"Weibull\", monitor=T, data=coalgov) #> Error in c(ids, vars, l1, l3) %<-% dissectFormula(formula, family, data): could not find function \"%<-%\" summary(m1) #> Error: object 'm1' not found"},{"path":"https://benrosche.github.io/bml/reference/vars.html","id":null,"dir":"Reference","previous_headings":"","what":"Specify variables ‚Äî vars","title":"Specify variables ‚Äî vars","text":"Helper function specify variables mm() hm() objects.","code":""},{"path":"https://benrosche.github.io/bml/reference/vars.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Specify variables ‚Äî vars","text":"","code":"vars(...)"},{"path":"https://benrosche.github.io/bml/reference/vars.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Specify variables ‚Äî vars","text":"... Unquoted variable names, can use + syntax (e.g., vars(x1 + x2) vars(x1, x2))","code":""},{"path":"https://benrosche.github.io/bml/reference/vars.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Specify variables ‚Äî vars","text":"bml_vars object containing variable names, NULL empty","code":""}]
