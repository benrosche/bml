<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model Structure • bml</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Model Structure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bml</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bml.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/installation.html">Installation</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/model.html">Model</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/examples.html">Examples</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/faq.html">FAQ</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benrosche/bml/" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Model Structure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/benrosche/bml/blob/HEAD/vignettes/model.Rmd" class="external-link"><code>vignettes/model.Rmd</code></a></small>
      <div class="d-none name"><code>model.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>bml</code> package implements Bayesian
<strong>multiple-membership multilevel models (MMMM)</strong> with
<strong>parameterizable weight functions</strong>. These models are
designed for data structures where:</p>
<ul>
<li>Lower-level units (members) can belong to multiple higher-level
units (groups)</li>
<li>Groups are composed of multiple members</li>
<li>Group outcomes depend on the combined influence of their constituent
members</li>
</ul>
<p>This structure is common across many empirical settings: political
parties participating in multiple coalition governments, individuals
participating in multiple teams, spatial units influenced by multiple
neighbors, or students in peer networks, where each student is
influenced by multiple peers.</p>
<p>The key innovation of the extended MMMM is that it allows researchers
to <strong>model rather than impose</strong> the aggregation mechanism
through which member-level effects combine to influence group-level
outcomes.</p>
</div>
<div class="section level2">
<h2 id="notation-and-data-structure">Notation and Data Structure<a class="anchor" aria-label="anchor" href="#notation-and-data-structure"></a>
</h2>
<p>Let:</p>
<ul>
<li>
<span class="math inline">\(i = 1, \ldots, N\)</span> index
<strong>groups</strong> (the primary unit of analysis)</li>
<li>
<span class="math inline">\(k = 1, \ldots, K\)</span> index
<strong>members</strong> (lower-level units)</li>
<li>
<span class="math inline">\(j = 1, \ldots, J\)</span> index
<strong>nesting units</strong> (higher-level contexts)</li>
<li>
<span class="math inline">\(p[i]\)</span> denote the set of members
belonging to group <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(n_i = |p[i]|\)</span> denote the number
of members in group <span class="math inline">\(i\)</span>
</li>
</ul>
<p><strong>Example (Coalition Governments):</strong> Groups are
governments (<span class="math inline">\(i\)</span>), members are
political parties (<span class="math inline">\(k\)</span>), and nesting
units are countries (<span class="math inline">\(j\)</span>). The
function <span class="math inline">\(p[i]\)</span> returns all parties
in government <span class="math inline">\(i\)</span>, and <span class="math inline">\(n_i\)</span> is coalition size.</p>
<p>The outcome <span class="math inline">\(y_i^{(g)}\)</span> is
measured at the group level, where superscript <span class="math inline">\((g)\)</span> denotes the level of measurement. In
what follows, we present the model for Gaussian (normal) outcomes,
though the framework extends to other distributions (see below).</p>
</div>
<div class="section level2">
<h2 id="the-extended-multiple-membership-multilevel-model">The Extended Multiple-Membership Multilevel Model<a class="anchor" aria-label="anchor" href="#the-extended-multiple-membership-multilevel-model"></a>
</h2>
<div class="section level3">
<h3 id="full-model-specification">Full Model Specification<a class="anchor" aria-label="anchor" href="#full-model-specification"></a>
</h3>
<p>The extended MMMM decomposes the group-level outcome into three
additive components, each corresponding to a level at which explanatory
factors operate:</p>
<p><span class="math display">\[\begin{equation}
y_i^{(g)} = \theta_i^{(g)} + \theta_{j[i]}^{(c)} + \theta_i^{(p)}
\tag{1}
\end{equation}\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\theta_i^{(g)}\)</span> denotes the
group-level effect associated with government <span class="math inline">\(i\)</span>.</li>
<li>
<span class="math inline">\(\theta_{j[i]}^{(c)}\)</span> denotes the
hierarchical nesting-level effect associated with country <span class="math inline">\(j[i]\)</span>.</li>
<li>
<span class="math inline">\(\theta_i^{(p)}\)</span> denotes the
aggregated member-level effect, summarizing party-level contributions
within government <span class="math inline">\(i\)</span>.</li>
</ul>
<p>Each component includes both systematic effects (observed covariates)
and random effects (unobserved heterogeneity).</p>
</div>
<div class="section level3">
<h3 id="group-level-effect">Group-Level Effect<a class="anchor" aria-label="anchor" href="#group-level-effect"></a>
</h3>
<p>The group-level effect models the direct influence of group-level
covariates and group-specific unobserved factors:</p>
<p><span class="math display">\[\begin{equation}
\theta_i^{(g)} = \mathbf{\beta}^{(g)} \cdot \mathbf{x}_i^{(g)} +
u_i^{(g)}, \quad u_i^{(g)} \overset{\text{iid}}{\sim} N(0,
\sigma_{u^{(g)}}^2) \tag{2}
\end{equation}\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{x}_i^{(g)} = [1, x_{1i}^{(g)},
\ldots, x_{Gi}^{(g)}]\)</span> is a vector of group-level
covariates</li>
<li>
<span class="math inline">\(\mathbf{\beta}^{(g)} = [\beta_0^{(g)},
\beta_1^{(g)}, \ldots, \beta_G^{(g)}]\)</span> are the corresponding
regression coefficients</li>
<li>
<span class="math inline">\(u_i^{(g)}\)</span> are independently and
identically distributed (i.i.d.) random effects</li>
<li>
<span class="math inline">\(\sigma_{u^{(g)}}^2\)</span> captures
unobserved heterogeneity at the group level</li>
</ul>
<p><strong>Example:</strong> For government survival, <span class="math inline">\(\mathbf{x}_i^{(g)}\)</span> might include majority
status, ideological heterogeneity, or economic conditions.</p>
</div>
<div class="section level3">
<h3 id="hierarchical-nesting-level-effect">Hierarchical Nesting-Level Effect<a class="anchor" aria-label="anchor" href="#hierarchical-nesting-level-effect"></a>
</h3>
<p>When groups are nested within higher-level contexts, the
nesting-level effect accounts for hierarchical dependencies:</p>
<p><span class="math display">\[\begin{equation}
\theta_j^{(c)} = \mathbf{\beta}^{(c)} \cdot \mathbf{x}_j^{(c)} +
u_j^{(c)}, \quad u_j^{(c)} \overset{\text{iid}}{\sim} N(0,
\sigma_{u^{(c)}}^2) \tag{3}
\end{equation}\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{x}_j^{(c)} = [x_{1j}^{(c)},
\ldots, x_{Cj}^{(c)}]\)</span> are nesting-level covariates</li>
<li>
<span class="math inline">\(\mathbf{\beta}^{(c)} = [\beta_1^{(c)},
\ldots, \beta_C^{(c)}]\)</span> are the corresponding coefficients</li>
<li>
<span class="math inline">\(u_j^{(c)}\)</span> are i.i.d. random
effects</li>
<li>
<span class="math inline">\(\sigma_{u^{(c)}}^2\)</span> captures
unobserved heterogeneity at the nesting level</li>
</ul>
<p>Including <span class="math inline">\(u_j^{(c)}\)</span> allows
groups within the same nesting unit to be more similar than groups
across nesting units, even after conditioning on observed
covariates.</p>
<p><strong>Example:</strong> Governments are nested within countries.
Country-level variables might include electoral system or investiture
requirements. The random effect captures country-specific factors
affecting all governments in that country.</p>
<p><strong>Note:</strong> Multiple <code><a href="../reference/hm.html">hm()</a></code> blocks can be
specified to accommodate cross-classified structures (e.g., groups
nested within multiple hierarchical contexts).</p>
</div>
<div class="section level3">
<h3 id="aggregated-member-level-effect">Aggregated Member-Level Effect<a class="anchor" aria-label="anchor" href="#aggregated-member-level-effect"></a>
</h3>
<p>The core innovation of the extended MMMM is modeling how member-level
effects aggregate to influence group outcomes. Individual member effects
are first specified, then aggregated via a weighted sum:</p>
<p><span class="math display">\[\begin{equation}
\theta_i^{(p)} = \sum_{k \in p[i]} w_{ik} \left( \mathbf{\beta}^{(p)}
\cdot \mathbf{x}_{ik}^{(p)} + u_k^{(p)} \right) \tag{4}
\end{equation}\]</span></p>
<p>This can be decomposed into systematic and random components:</p>
<p><span class="math display">\[\begin{equation}
\theta_i^{(p)} = \underbrace{\mathbf{\beta}^{(p)} \sum_{k \in p[i]}
w_{ik} \mathbf{x}_{ik}^{(p)}}_{\text{Systematic component}} +
\underbrace{\sum_{k \in p[i]} w_{ik}
u_k^{(p)}}_{\text{Random  component}}, \quad u_k^{(p)}
\overset{\text{iid}}{\sim} N(0, \sigma_{u^{(p)}}^2) \tag{5}
\end{equation}\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{x}_{ik}^{(p)} = [x_{1ik}^{(p)},
\ldots, x_{Pik}^{(p)}]\)</span> are member-level covariates</li>
<li>
<span class="math inline">\(\mathbf{\beta}^{(p)} = [\beta_1^{(p)},
\ldots, \beta_P^{(p)}]\)</span> are structural regression coefficients
measuring the effect of member attributes on group outcomes</li>
<li>
<span class="math inline">\(w_{ik}\)</span> are <strong>aggregation
weights</strong> determining how member <span class="math inline">\(k\)</span>’s contribution enters group <span class="math inline">\(i\)</span>’s outcome</li>
<li>
<span class="math inline">\(u_k^{(p)}\)</span> are i.i.d.
member-specific random effects</li>
<li>
<span class="math inline">\(\sigma_{u^{(p)}}^2\)</span> captures
unobserved heterogeneity at the member level</li>
</ul>
<p><strong>Interpretation of Weights:</strong> The weights <span class="math inline">\(w_{ik}\)</span> define the <strong>micro-macro
link</strong> — how individual member characteristics combine to produce
group-level attributes. Since the structural effect <span class="math inline">\(\mathbf{\beta}^{(p)}\)</span> is constant, the
weights serve to aggregate the member-level covariate <span class="math inline">\(\mathbf{x}_{ik}^{(p)}\)</span> into a group-level
construct <span class="math inline">\(\sum_{k \in p[i]} w_{ik}
\mathbf{x}_{ik}^{(p)}\)</span>.</p>
<p><strong>Covariance Structure:</strong> Including member-specific
random effects <span class="math inline">\(u_k^{(p)}\)</span> induces
covariance among groups sharing members. The covariance between groups
<span class="math inline">\(i\)</span> and <span class="math inline">\(i'\)</span> is:</p>
<p><span class="math display">\[\begin{equation}
\text{Cov}(y_i^{(g)}, y_{i'}^{(g)}) = \sigma_{u^{(p)}}^2 \sum_k
w_{ik} w_{i'k} \tag{6}
\end{equation}\]</span></p>
<p>This increases with the degree of member overlap and accounts for
dependencies across groups involving recurring members.</p>
<p><strong>Example:</strong> In coalition governments, <span class="math inline">\(\mathbf{x}_{ik}^{(p)}\)</span> might include party
cohesion or organizational structure. The random effect <span class="math inline">\(u_k^{(p)}\)</span> captures party-specific
unobserved factors that affect all governments in which party <span class="math inline">\(k\)</span> participates.</p>
</div>
</div>
<div class="section level2">
<h2 id="parameterizable-weight-functions">Parameterizable Weight Functions<a class="anchor" aria-label="anchor" href="#parameterizable-weight-functions"></a>
</h2>
<div class="section level3">
<h3 id="conventional-mmmm-fixed-weights">Conventional MMMM: Fixed Weights<a class="anchor" aria-label="anchor" href="#conventional-mmmm-fixed-weights"></a>
</h3>
<p>The <strong>conventional MMMM</strong> requires weights to be
specified <em>a priori</em>. The most common choice is equal weighting
(arithmetic mean):</p>
<p><span class="math display">\[\begin{equation}
w_{ik} = \frac{1}{n_i} \tag{7}
\end{equation}\]</span></p>
<p>This assumes all members contribute equally to group outcomes,
regardless of their attributes or context.</p>
<p><strong>Limitations:</strong> Equal weighting can be theoretically
implausible. In coalition governments, for instance, larger parties,
parties holding the prime ministership, or ideologically central parties
may exert disproportionate influence. In spatial analysis, nearby
neighbors may matter more than distant ones. Imposing equal weights when
they vary in practice introduces <strong>aggregation bias</strong>.</p>
</div>
<div class="section level3">
<h3 id="extended-mmmm-parameterizing-weights">Extended MMMM: Parameterizing Weights<a class="anchor" aria-label="anchor" href="#extended-mmmm-parameterizing-weights"></a>
</h3>
<p>The <strong>extended MMMM</strong> allows weights to be modeled as
functions of covariates and estimated parameters. For example,</p>
<p><span class="math display">\[\begin{equation}
w_{ik}(\mathbf{x}_{ik}^{(w)}, n_i) = \frac{1}{1 + (n_i - 1)
\exp\left(-\mathbf{\beta}^{(w)} \cdot \mathbf{x}_{ik}^{(w)}\right)}
\tag{8}
\end{equation}\]</span></p>
<p>subject to the normalization constraint <span class="math inline">\(\sum_{k \in p[i]} w_{ik} = 1\)</span> for all
<span class="math inline">\(i\)</span>.</p>
<p>In <code>bml</code>, this is specified via:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">b0</span> <span class="op">+</span> <span class="va">b1</span> <span class="op">*</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">b2</span> <span class="op">*</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{x}_{ik}^{(w)} = [1,
x_{1ik}^{(w)}, \ldots, x_{Wik}^{(w)}]\)</span> are <strong>weight
covariates</strong>
</li>
<li>
<span class="math inline">\(\mathbf{\beta}^{(w)} = [\beta_0^{(w)},
\beta_1^{(w)}, \ldots, \beta_W^{(w)}]\)</span> are <strong>weight
function parameters</strong> to be estimated</li>
</ul>
<p><strong>Functional Form:</strong> Equation (8) generalizes the
logistic function by centering it at <span class="math inline">\(1/n_i\)</span> when <span class="math inline">\(\mathbf{\beta}^{(w)} \cdot \mathbf{x}_{ik}^{(w)} =
0\)</span>. This sets equal weighting as the baseline: absent systematic
differences, each member receives weight <span class="math inline">\(1/n_i\)</span>. When <span class="math inline">\(\mathbf{\beta}^{(w)} \neq 0\)</span>, weights
deviate from this baseline, reflecting heterogeneous member
influence.</p>
<p><strong>Properties:</strong></p>
<ul>
<li>Bounded: <span class="math inline">\(w_{ik} \in [0, 1]\)</span>
</li>
<li>Baseline-centered: When <span class="math inline">\(\mathbf{\beta}^{(w)} = 0\)</span>, weights reduce
to <span class="math inline">\(w_{ik} = 1/n_i\)</span>
</li>
<li>Monotonic: Weights increase/decrease smoothly with the linear
predictor</li>
<li>Normalized: Constraint ensures <span class="math inline">\(\sum_k
w_{ik} = 1\)</span> (unless normalization is not desired)</li>
</ul>
<p><strong>Interpretation of Weight Parameters:</strong> While <span class="math inline">\(\mathbf{\beta}^{(p)}\)</span> measure
<em>structural effects</em> of member attributes on group outcomes,
<span class="math inline">\(\mathbf{\beta}^{(w)}\)</span> measure
<em>aggregation effects</em>—how member attributes determine their
relative importance in the weighted sum. Together, they reveal both
<em>what</em> matters (structural effects) and <em>how much</em>
different members’ characteristics matter (aggregation effects).</p>
<p><strong>Example:</strong> Let <span class="math inline">\(x_{ik}^{(p)}\)</span> = party cohesion and <span class="math inline">\(x_{ik}^{(w)}\)</span> = indicator for holding the
prime ministership in a government survival model.</p>
<ul>
<li>If <span class="math inline">\(\beta^{(w)} = 0\)</span>: Prime
minister’s cohesion matters as much as coalition partners’ cohesion
(equal weights)</li>
<li>If <span class="math inline">\(\beta^{(w)} &gt; 0\)</span>: Prime
minister’s cohesion carries more weight</li>
<li>If <span class="math inline">\(\beta^{(w)} &lt; 0\)</span>:
Coalition partners’ cohesion carries more weight</li>
</ul>
</div>
<div class="section level3">
<h3 id="testing-alternative-aggregation-mechanisms">Testing Alternative Aggregation Mechanisms<a class="anchor" aria-label="anchor" href="#testing-alternative-aggregation-mechanisms"></a>
</h3>
<p>Weight function regression enables empirical tests of substantive
hypotheses about aggregation. Group-level functions such as
<code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max()</a></code>, <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code>, and
<code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> can be incorporated directly into weight formulas,
and standard mathematical transformations are supported. For
example:</p>
<p><strong>1. Mean vs. Extremes:</strong> Does the group outcome depend
on the average member attribute or on extreme values
(minimum/maximum)?</p>
<p><span class="math display">\[w_{ik} = \beta_1^{(w)} \cdot
x_{ik}^{(w)} + (1 - \beta_1^{(w)}) \cdot \mathbb{1}\left[x_{ik}^{(w)} =
\min_k x_{ik}^{(w)}\right]\]</span></p>
<p>In <code>bml</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span></span>
<span>  <span class="va">w</span> <span class="op">~</span> <span class="va">b1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">b1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The parameter <span class="math inline">\(\beta_1^{(w)}\)</span>
controls the mixture between aggregation mechanisms. When <span class="math inline">\(\beta_1^{(w)} = 1\)</span>, weights are
proportional to <span class="math inline">\(x_{ik}^{(w)}\)</span>
(mean-like aggregation); when <span class="math inline">\(\beta_1^{(w)}
= 0\)</span>, all weight is assigned to the member with the minimum
value. Intermediate values yield a convex combination of both. Replacing
min() with max() tests whether the highest-valued member dominates. To
preserve this interpretation, <span class="math inline">\(\beta_1^{(w)}\)</span> should be constrained to
<span class="math inline">\([0,1]\)</span>, e.g., via priors =
list(“b1~dunif(0,1)”).</p>
<p><strong>2. Mean vs. Sum:</strong> Are member effects
<em>contextual</em> (mean aggregation: <span class="math inline">\(\sum_k w_{ik} = 1\)</span>) or <em>autonomous</em>
(sum aggregation: <span class="math inline">\(\sum_k w_{ik} =
n_i\)</span>)?</p>
<p><span class="math display">\[w_{ik} = \frac{1}{1 + (n_i - 1)
\exp\left(-\beta_0^{(w)}\right)}\]</span></p>
<p>In <code>bml</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span></span>
<span>  <span class="va">w</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">b0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When <span class="math inline">\(\beta_0^{(w)} \approx 0\)</span>,
the weight evaluates to <span class="math inline">\(1/n_i\)</span>,
yielding mean aggregation (<span class="math inline">\(\sum_k w_{ik} =
1\)</span>). As <span class="math inline">\(\beta_0^{(w)}\)</span> grows
large, the weight approaches 1 for each member, yielding sum aggregation
(<span class="math inline">\(\sum_k w_{ik} = n_i\)</span>). Under mean
aggregation, a one-unit change in <span class="math inline">\(x_{ik}^{(p)}\)</span> affects the outcome by <span class="math inline">\(\beta^{(p)}\)</span> only if <em>all</em> members
change. Under sum aggregation, a one-unit change by a <em>single</em>
member already produces an effect of <span class="math inline">\(\beta^{(p)}\)</span>.</p>
<p><strong>3. Asymmetric Influence:</strong> Do certain members (e.g.,
larger, more central, more powerful) carry disproportionate weight?</p>
<p><span class="math display">\[
w_{ik} = \frac{1}{1 + (n_i - 1) \exp\left(-(\beta_0^{(w)} +
\beta_1^{(w)} x_{1ik}^{(w)} + \beta_2^{(w)} x_{2ik}^{(w)})\right)}
\]</span></p>
<p>In <code>bml</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span></span>
<span>  <span class="va">w</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">b0</span> <span class="op">+</span> <span class="va">b1</span> <span class="op">*</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">b2</span> <span class="op">*</span> <span class="va">x2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  c <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This weight function tests whether member attributes <span class="math inline">\(x_1, x_2\)</span> (e.g., size, organization,
power) generate disproportionate influence via <span class="math inline">\(\beta_1^{(w)}, \beta_2^{(w)}\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="generalized-outcomes">Generalized Outcomes<a class="anchor" aria-label="anchor" href="#generalized-outcomes"></a>
</h2>
<p>The model structure extends to non-Gaussian outcomes via generalized
linear and survival models:</p>
<p><strong>Binomial (Logistic Regression):</strong></p>
<p><span class="math display">\[\begin{equation}
\text{logit}\left(P(y_i^{(g)} = 1)\right) = \theta_i^{(g)} +
\theta_{j[i]}^{(c)} + \theta_i^{(p)} \tag{9}
\end{equation}\]</span></p>
<p>In <code>bml</code>, specify <code>family = "Binomial"</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bml.html">bml</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/hm.html">hm</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"Binomial"</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><strong>Weibull Survival Model:</strong></p>
<p><span class="math display">\[\begin{equation}
\log(t_i) = \theta_i^{(g)} + \theta_{j[i]}^{(c)} + \theta_i^{(p)} +
\sigma \epsilon_i \tag{10}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(t_i\)</span> is survival time,
<span class="math inline">\(\epsilon_i\)</span> follows an extreme value
distribution, and <span class="math inline">\(\sigma\)</span> is the
scale parameter related to the Weibull shape parameter.</p>
<p>In <code>bml</code>, specify <code>family = "Weibull"</code> with a
<code>Surv()</code> outcome:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bml.html">bml</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/hm.html">hm</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"Weibull"</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><strong>Cox Proportional Hazards Model:</strong></p>
<p><span class="math display">\[\begin{equation}
h(t_i) = h_0(t) \exp\left(\theta_i^{(g)} + \theta_{j[i]}^{(c)} +
\theta_i^{(p)}\right) \tag{11}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(h_0(t)\)</span> is the baseline
hazard function, estimated non-parametrically or as a piecewise constant
function.</p>
<p>In <code>bml</code>, specify <code>family = "Cox"</code>. The
optional <code>cox_intervals</code> argument controls the number of
intervals for the piecewise constant baseline hazard:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bml.html">bml</a></span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/hm.html">hm</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"Cox"</span>, cox_intervals <span class="op">=</span> <span class="fl">10</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p>All outcome types support the full multilevel and multiple-membership
structure, including parameterizable weight functions.</p>
</div>
<div class="section level2">
<h2 id="variance-decomposition-and-intraclass-correlation">Variance Decomposition and Intraclass Correlation<a class="anchor" aria-label="anchor" href="#variance-decomposition-and-intraclass-correlation"></a>
</h2>
<p>The multilevel structure partitions total variance into additive
components corresponding to each level in the model. For a three-level
model with group, nesting, and member levels:</p>
<p><span class="math display">\[\begin{equation}
\text{Var}(y_i^{(g)}) = \sigma_{u^{(g)}}^2 + \sigma_{u^{(c)}}^2 +
\sigma_{u^{(p)}}^2 \sum_{k \in p[i]} w_{ik}^2 \tag{12}
\end{equation}\]</span></p>
<p>Note that the member-level variance component is scaled by the sum of
squared weights. With equal weights (<span class="math inline">\(w_{ik}
= 1/n_i\)</span>), this simplifies to <span class="math inline">\(\sigma_{u^{(p)}}^2 / n_i\)</span>, so the
effective member-level variance shrinks as group size increases. With
unequal weights, members with larger weights contribute more to the
variance.</p>
<div class="section level3">
<h3 id="intraclass-correlation-coefficients-icc">Intraclass Correlation Coefficients (ICC)<a class="anchor" aria-label="anchor" href="#intraclass-correlation-coefficients-icc"></a>
</h3>
<p>The <strong>intraclass correlation coefficient (ICC)</strong> for a
given level is the proportion of total variance attributable to that
level. Intuitively, the ICC answers: <em>“What fraction of the total
variation in the outcome is due to differences between units at this
level?”</em></p>
<p>For example, an ICC of 0.30 for the country level means that 30% of
the outcome variation can be attributed to between-country differences,
while the remaining 70% arises from variation at other levels (e.g.,
between groups within countries, or between members).</p>
<p><span class="math display">\[\begin{align}
\rho^{(g)} &amp;= \frac{\sigma_{u^{(g)}}^2}{\sigma_{u^{(g)}}^2 +
\sigma_{u^{(c)}}^2 + \sigma_{u^{(p)}}^2 \overline{w^2}} \tag{13} \\
\rho^{(c)} &amp;= \frac{\sigma_{u^{(c)}}^2}{\sigma_{u^{(g)}}^2 +
\sigma_{u^{(c)}}^2 + \sigma_{u^{(p)}}^2 \overline{w^2}} \tag{14} \\
\rho^{(p)} &amp;= \frac{\sigma_{u^{(p)}}^2
\overline{w^2}}{\sigma_{u^{(g)}}^2 + \sigma_{u^{(c)}}^2 +
\sigma_{u^{(p)}}^2 \overline{w^2}} \tag{15}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\overline{w^2} = \frac{1}{N}
\sum_{i=1}^{N} \sum_{k \in p[i]} w_{ik}^2\)</span> is the average sum of
squared weights across groups.</p>
<p>Since the model is estimated via MCMC, the ICCs inherit full
posterior distributions. The <code><a href="../reference/varDecomp.html">varDecomp()</a></code> function computes
ICCs per posterior draw and summarizes them, properly propagating
uncertainty:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bml.html">bml</a></span><span class="op">(</span></span>
<span>  <span class="fu">Surv</span><span class="op">(</span><span class="va">dur_wkb</span>, <span class="va">event_wkb</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">majority</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">cohesion</span><span class="op">)</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/hm.html">hm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">cid</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"RE"</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"Weibull"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">coalgov</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/varDecomp.html">varDecomp</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/varDecomp.html">varDecomp</a></span><span class="op">(</span><span class="va">m1</span>, uncertainty <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>uncertainty</code> argument controls the reported
uncertainty measure: <code>"sd"</code> (posterior standard deviation,
the default), <code>"mad"</code> (median absolute deviation), or
<code>"ci"</code> (95% credible intervals).</p>
<p><strong>Family-specific handling:</strong> For Binomial models, which
have no residual <span class="math inline">\(\sigma\)</span>, the latent
logistic residual variance <span class="math inline">\(\pi^2/3 \approx
3.29\)</span> is used. For Cox models, which also lack a residual
variance, ICCs are computed among the non-residual components only.</p>
</div>
</div>
<div class="section level2">
<h2 id="extensions">Extensions<a class="anchor" aria-label="anchor" href="#extensions"></a>
</h2>
<div class="section level3">
<h3 id="multiple-mm-blocks">Multiple MM Blocks<a class="anchor" aria-label="anchor" href="#multiple-mm-blocks"></a>
</h3>
<p>The <code>bml</code> package allows multiple <code><a href="../reference/mm.html">mm()</a></code> blocks
with distinct aggregation mechanisms. This is useful when different
member-level covariates aggregate through different processes:</p>
<p><span class="math display">\[\begin{equation}
\theta_i^{(p)} = \sum_{b=1}^B \sum_{k \in p[i]} w_{ik}^{(b)} \left(
\mathbf{\beta}^{(p,b)} \cdot \mathbf{x}_{ik}^{(p,b)} + u_k^{(p,b)}
\right) \tag{16}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(b\)</span> indexes MM blocks, each
with its own weight function <span class="math inline">\(w_{ik}^{(b)} =
f(\mathbf{x}_{ik}^{(w,b)}, n_i)\)</span>.</p>
<p><strong>Example:</strong> Model the effect of the cohesion of the
party with the largest seat share while the party random effects are
specified with equal weights:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">cohesion</span><span class="op">)</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="va">pseat</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pseat</span><span class="op">)</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="cn">NULL</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Important:</strong> For any given <code>id(pid, gid)</code>
combination, only one <code><a href="../reference/mm.html">mm()</a></code> block may include
<code>RE = TRUE</code> within the same model.</p>
</div>
<div class="section level3">
<h3 id="autoregressive-random-effects">Autoregressive Random Effects<a class="anchor" aria-label="anchor" href="#autoregressive-random-effects"></a>
</h3>
<p>Member random effects may evolve over time rather than remain
constant. The <code>ar = TRUE</code> option specifies a random walk
process:</p>
<p><span class="math display">\[\begin{equation}
u_{ik}^{(p)} \sim \begin{cases}
N(0, \sigma_{u^{(p)}}^2) &amp; \text{if } g[i,k] = \emptyset \\
N(u_{g[i,k],k}^{(p)}, \sigma_{u^{(p)}}^2) &amp; \text{if } g[i,k] \neq
\emptyset
\end{cases} \tag{17}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(g[i,k]\)</span> returns the most
recent previous group in which member <span class="math inline">\(k\)</span> participated. For <span class="math inline">\(g[i,k] = \emptyset\)</span> (first participation),
the effect is drawn from the prior.</p>
<p><strong>Interpretation:</strong> Autoregressive effects capture
dynamics where a member’s unobserved heterogeneity changes across
successive group participations. The variance <span class="math inline">\(\sigma_{u^{(p)}}^2\)</span> now represents the
<em>innovation variance</em> governing temporal change.</p>
<p><strong>Example:</strong> A party’s propensity to destabilize
governments may evolve as its leadership, organization, or electoral
fortunes change.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">cohesion</span><span class="op">)</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">TRUE</span>, ar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="opposition-members">Opposition Members<a class="anchor" aria-label="anchor" href="#opposition-members"></a>
</h3>
<p>When analyzing group outcomes influenced by both members and
non-members (e.g., coalition and opposition parties), separate
<code><a href="../reference/mm.html">mm()</a></code> blocks can model their distinct contributions:</p>
<p><span class="math display">\[\begin{equation}
\theta_i^{(p)} = \sum_{k \in p[i]} w_{ik}^{(g)} \left(
\mathbf{\beta}^{(g)} \cdot \mathbf{x}_{ik}^{(g)} + u_k^{(g)} \right) +
\sum_{k \notin p[i]} w_{ik}^{(o)} \left( \mathbf{\beta}^{(o)} \cdot
\mathbf{x}_{ik}^{(o)} + u_k^{(o)} \right) \tag{18}
\end{equation}\]</span></p>
<p>where superscripts <span class="math inline">\((g)\)</span> and <span class="math inline">\((o)\)</span> denote member and non-member effects,
respectively. This allows both groups to have different structural
effects and different aggregation mechanisms.</p>
<p>In <code>bml</code>, this is specified using two <code><a href="../reference/mm.html">mm()</a></code>
blocks with different mmid variables — one for members (<span class="math inline">\(k \in p[i]\)</span>) and one for non-members
(<span class="math inline">\(k \notin p[i]\)</span>):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">pid_g</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu"><a href="../reference/mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="../reference/id.html">id</a></span><span class="op">(</span><span class="va">pid_o</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/vars.html">vars</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>, fn <span class="op">=</span> <span class="fu"><a href="../reference/fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Data format:</strong> Since the two <code><a href="../reference/mm.html">mm()</a></code> blocks
use different member ID variables (<code>pid_g</code> and
<code>pid_o</code>), the data should be in a stacked long format where
each member gets its own row, with <code>NA</code> in the mmid column it
does not belong to:</p>
<pre><code>gid  pid_g  pid_o  x1    x2    dur_wkb  event_wkb
1    1      NA     0.5   0.3   365      0
1    2      NA     0.4   0.2   365      0
1    NA     3      0.3   0.1   365      0
1    NA     4      0.7   0.5   365      0</code></pre>
<p>Government parties have <code>pid_g</code> filled and
<code>pid_o = NA</code>; opposition parties have <code>pid_o</code>
filled and <code>pid_g = NA</code>. Group-level variables (e.g.,
<code>dur_wkb</code>, <code>event_wkb</code>) are repeated across all
rows within a group, as in the standard long format.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-conventional-mmmm">Comparison with Conventional MMMM<a class="anchor" aria-label="anchor" href="#comparison-with-conventional-mmmm"></a>
</h2>
<p>The <strong>conventional MMMM</strong> (as implemented in
<code>brms</code> or <code>MLwiN</code>) is a special case:</p>
<p><span class="math display">\[\begin{equation}
y_i^{(g)} = \mathbf{\beta}^{(g)} \cdot \mathbf{x}_i^{(g)} +
\mathbf{\beta}^{(p)} \cdot \bar{\mathbf{x}}_{i}^{(p)} + \sum_{k \in
p[i]} w_{ik} u_k^{(p)} + u_i^{(g)}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\bar{\mathbf{x}}_{i}^{(p)} = \sum_k
w_{ik} \mathbf{x}_{ik}^{(p)}\)</span> is pre-aggregated using
<em>imposed</em> weights <span class="math inline">\(w_{ik}\)</span>.</p>
<p>The <strong>extended MMMM</strong> generalizes this by:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Aggregating both systematic and random components</strong>
within the model</li>
<li>
<strong>Endogenizing weights</strong> as functions of covariates
with estimable parameters</li>
<li>
<strong>Enabling multiple aggregation mechanisms</strong> via
multiple <code><a href="../reference/mm.html">mm()</a></code> blocks</li>
</ol>
<p><span class="math display">\[\begin{equation}
y_i^{(g)} = \mathbf{\beta}^{(g)} \cdot \mathbf{x}_i^{(g)} + \sum_{k \in
p[i]} w_{ik} \left( \mathbf{\beta}^{(p)} \cdot \mathbf{x}_{ik}^{(p)} +
u_k^{(p)} \right) + u_i^{(g)}, \quad w_{ik} = f(\mathbf{x}_{ik}^{(w)},
n_i)
\end{equation}\]</span></p>
</div>
<div class="section level2">
<h2 id="model-assumptions">Model Assumptions<a class="anchor" aria-label="anchor" href="#model-assumptions"></a>
</h2>
<p>The extended MMMM assumes:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Independence of random components</strong> across levels:
<span class="math inline">\(u_i^{(g)} \perp u_j^{(c)} \perp
u_k^{(p)}\)</span>. If violated, variance estimates may be biased. More
complex covariance structures can be accommodated if needed.</p></li>
<li><p><strong>Random effects are uncorrelated with covariates</strong>
(random effects assumption). However, including within-cluster means of
covariates or using within-between specifications isolates
within-cluster effects, yielding identical point estimates to fixed
effect models.</p></li>
<li><p><strong>Correct functional form</strong> for weight function. The
logistic-type function in Equation (8) is flexible, but other forms can
be specified using the <code><a href="../reference/fn.html">fn()</a></code> syntax.</p></li>
<li><p><strong>Proper model specification:</strong> Misspecifying a
weight covariate as a structural covariate (or vice versa) yields null
effects for the misspecified variable while correctly identifying
properly specified ones, provided there is no omitted variable
bias.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h2>
<p>Model parameters are estimated using <strong>Bayesian Markov chain
Monte Carlo (MCMC)</strong> via JAGS because:</p>
<ol style="list-style-type: decimal">
<li>The likelihood has no closed-form solution due to the parameterized
weight function</li>
<li>Bayesian estimation captures uncertainty in variance estimates,
yielding credible intervals even when maximum likelihood methods report
zero variance</li>
<li>Weakly informative priors can be specified for all parameters to
regularize estimates in small samples</li>
</ol>
<p>The <code>bml</code> package provides a user-friendly interface to
JAGS with automated prior specification, convergence diagnostics, and
post-estimation tools.</p>
</div>
<div class="section level2">
<h2 id="further-information">Further Information<a class="anchor" aria-label="anchor" href="#further-information"></a>
</h2>
<p>A comprehensive presentation of the model is provided in <a href="https://osf.io/preprints/socarxiv/4bafr" class="external-link">Rosche (2026)</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://benrosche.com" class="external-link">Benjamin Rosche</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
