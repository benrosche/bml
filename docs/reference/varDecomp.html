<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Variance decomposition for fitted bml models — varDecomp • bml</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Variance decomposition for fitted bml models — varDecomp"><meta name="description" content="Computes a posterior variance decomposition and intraclass correlation
coefficients (ICCs) from a fitted bml model. The function automatically
discovers all variance components (sigma parameters) in the model, applies
weight adjustments for multiple-membership levels, and returns posterior
summaries."><meta property="og:description" content="Computes a posterior variance decomposition and intraclass correlation
coefficients (ICCs) from a fitted bml model. The function automatically
discovers all variance components (sigma parameters) in the model, applies
weight adjustments for multiple-membership levels, and returns posterior
summaries."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bml</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bml.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/installation.html">Installation</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/model.html">Model</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/examples.html">Examples</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/faq.html">FAQ</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benrosche/bml/" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Variance decomposition for fitted bml models</h1>
      <small class="dont-index">Source: <a href="https://github.com/benrosche/bml/blob/HEAD/R/varDecomp.R" class="external-link"><code>R/varDecomp.R</code></a></small>
      <div class="d-none name"><code>varDecomp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Computes a posterior variance decomposition and intraclass correlation
coefficients (ICCs) from a fitted <code>bml</code> model. The function automatically
discovers all variance components (sigma parameters) in the model, applies
weight adjustments for multiple-membership levels, and returns posterior
summaries.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">varDecomp</span><span class="op">(</span><span class="va">model</span>, uncertainty <span class="op">=</span> <span class="st">"sd"</span>, r <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A fitted model object of class <code>"bml"</code> returned by <code><a href="bml.html">bml</a></code>.
Must have been fitted with <code>monitor = TRUE</code> (the default).</p></dd>


<dt id="arg-uncertainty">uncertainty<a class="anchor" aria-label="anchor" href="#arg-uncertainty"></a></dt>
<dd><p>Uncertainty measure to report. One of <code>"sd"</code> (posterior
standard deviation, the default), <code>"mad"</code> (median absolute deviation), or
<code>"ci"</code> (95% credible interval with lower/upper bounds).</p></dd>


<dt id="arg-r">r<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>Number of decimal places for rounding numeric output. Default: 2.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame of class <code>"bml_varDecomp"</code> with one row per variance
  component. Always includes <code>Component</code>, <code>sigma</code>, and <code>ICC</code> columns.
  Additional columns depend on <code>uncertainty</code>:</p><ul><li><p><code>"sd"</code>: <code>sigma_sd</code> and <code>ICC_sd</code></p></li>
<li><p><code>"mad"</code>: <code>sigma_mad</code> and <code>ICC_mad</code></p></li>
<li><p><code>"ci"</code>: <code>sigma_lb</code>, <code>sigma_ub</code>, <code>ICC_lb</code>, <code>ICC_ub</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Variance decomposition.</strong>
The total variance of the outcome is partitioned into additive components,
one for each level in the model:</p>
<p>$$\mathrm{Var}(y) = \sigma_1^2 + \sigma_2^2 + \ldots$$</p>
<p>Each component contributes variance \(\sigma^2\), except for multiple-membership (MM) levels,
where the effective variance contribution is scaled by the average of the summed squared weights
across groups.</p>
<p>$$\mathrm{Var}_{\mathrm{mm}} = \sigma_{\mathrm{mm}}^2 \cdot \overline{w^2},
\quad \overline{w^2} = \frac{1}{N} \sum_{i=1}^{N} \sum_{k} w_{ik}^2$$</p>
<p>This weight adjustment accounts for the fact that the member-level variance is
distributed across multiple members with potentially unequal influence. With
equal weights (\(w_{ik} = 1/n_i\)), the effective variance shrinks as group
size increases.</p>
<p><strong>Intraclass Correlation Coefficient (ICC).</strong>
The ICC for a given level is the proportion of total variance attributable to
that level:</p>
<p>$$\rho_l = \frac{\sigma_l^2}{\sum_{l'} \sigma_{l'}^2}$$</p>
<p>Intuitively, the ICC answers: "What fraction of the total variation in the
outcome is due to differences between units at this level?" An ICC of 0.30
for the country level, for example, means that 30% of the outcome variation
can be attributed to between-country differences.</p>
<p>ICCs are computed per posterior draw and then summarized, properly propagating
uncertainty from the MCMC samples.</p>
<p><strong>Family-specific handling:</strong></p><ul><li><p><strong>Gaussian / Weibull</strong>: The residual <code>sigma</code> from the model
    is used directly.</p></li>
<li><p><strong>Binomial</strong>: There is no residual sigma. The latent logistic
    residual variance \(\pi^2/3 \approx 3.29\) is used instead.</p></li>
<li><p><strong>Cox</strong>: There is no residual variance. ICCs are computed among
    the non-residual components only.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="bml.html">bml</a></code>, <code><a href="summary.bml.html">summary.bml</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Benjamin Rosche &lt;benrosche@nyu.edu&gt;</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">coalgov</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="bml.html">bml</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">Surv</span><span class="op">(</span><span class="va">dur_wkb</span>, <span class="va">event_wkb</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">majority</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="mm.html">mm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="id.html">id</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">gid</span><span class="op">)</span>, vars <span class="op">=</span> <span class="fu"><a href="vars.html">vars</a></span><span class="op">(</span><span class="va">cohesion</span><span class="op">)</span>, fn <span class="op">=</span> <span class="fu"><a href="fn.html">fn</a></span><span class="op">(</span><span class="va">w</span> <span class="op">~</span> <span class="fl">1</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, RE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="hm.html">hm</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="id.html">id</a></span><span class="op">(</span><span class="va">cid</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"RE"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="st">"Weibull"</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">coalgov</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">varDecomp</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">varDecomp</span><span class="op">(</span><span class="va">m1</span>, uncertainty <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">varDecomp</span><span class="op">(</span><span class="va">m1</span>, uncertainty <span class="op">=</span> <span class="st">"mad"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://benrosche.com" class="external-link">Benjamin Rosche</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

